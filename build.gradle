/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * To learn more about Gradle by exploring our Samples at https://docs.gradle.org/8.7/samples
 *
 * Generated by m30pm during project creation.
 */

plugins {
    id 'base'
}

def schemaFileName = "computational-analysis-schema.yaml"
def src = "$projectDir/model/schema"
def schemaOutDir = "schema"
def schemaBuildDir = "$buildDir/$schemaOutDir"
def unifiedSchemaPath = "$schemaBuildDir/$schemaFileName"

tasks.register('buildUnifiedYaml', Exec) {
    inputs.files(fileTree("$src"))
        .withPropertyName('sourceFiles')
        .withPathSensitivity(PathSensitivity.ABSOLUTE)
    outputs.dir(layout.buildDirectory.dir("$schemaOutDir"))
        .withPropertyName('outputDir')
    commandLine "bash", "-c", "gen-yaml $src/$schemaFileName --mergeimports > $unifiedSchemaPath"
}

tasks.register('cleanupUnifiedYaml', Exec) {
    dependsOn(buildUnifiedYaml)
    inputs.files(fileTree("$schemaOutDir"))
        .withPropertyName('sourceFiles')
        .withPathSensitivity(PathSensitivity.ABSOLUTE)
    outputs.dir(layout.buildDirectory.dir("$schemaOutDir"))
        .withPropertyName('outputDir')
    commandLine "yq", "-i", "del(.imports)", "$unifiedSchemaPath"
}

tasks.named("assemble") {
    dependsOn(cleanupUnifiedYaml)
}
